<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
  <title>RainbowGold Tap</title>
  <meta name="theme-color" content="#1b103a" />

  <!-- Preloads -->
  <link rel="preload" as="image" href="assets/img/Coin.png" imagesrcset="assets/img/Coin.png 1x, assets/img/Coin@2x.png 2x">
  <link rel="preload" as="image" href="assets/img/brand-mark-wg-128.png">

  <!-- Estilos -->
  <link rel="stylesheet" href="css/styles.css" />

  <!-- ‚úÖ CSP relajada para MiniKit y tu API -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' https://unpkg.com 'unsafe-inline' 'unsafe-eval';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data:;
    font-src 'self';
    connect-src 'self' https://rainbowgold-api.vercel.app https://developer.worldcoin.org https://unpkg.com;
    media-src 'self';
  ">

  <meta http-equiv="Referrer-Policy" content="no-referrer" />
  <meta http-equiv="Permissions-Policy" content="
    accelerometer=(), camera=(), geolocation=(), gyroscope=(),
    magnetometer=(), microphone=(), payment=(), usb=()
  ">

  <!-- MiniKit (CDN oficial) -->
  <script src="https://unpkg.com/@worldcoin/minikit-js@latest/dist/index.umd.js"></script>

  <!-- Config global del backend -->
  <script>
    // ‚ö†Ô∏è usa SIEMPRE window.API_BASE (con guion bajo)
    window.API_BASE = "https://rainbowgold-api.vercel.app";
  </script>
</head>

<body>
  <!-- === SPLASH / CARGA INICIAL === -->
  <div id="splash" class="splash" aria-busy="true" aria-label="Cargando RainbowGold">
    <div class="splash__logo">
      <img src="assets/img/logo-splash.png" alt="RainbowGold" fetchpriority="high" decoding="async">
    </div>

    <button id="wldSignIn" style="
      margin-top:18px;padding:12px 16px;border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      color:#fff;font-weight:700;cursor:pointer">
      Entrar con World ID
    </button>

    <div id="wldState" class="splash__hint" style="margin-top:10px;opacity:1;transform:translateY(0)">
      <span>Preparando tu sesi√≥n</span>
      <span class="dots"><span>.</span><span>.</span><span>.</span></span>
    </div>
  </div>

  <!-- Left FABs -->
  <div class="floatCol">
    <button id="profileBtn" class="fab profile" title="Profile">
      <img src="assets/img/icon-profile.png" alt="Perfil" style="width:45px;height:45px;">
    </button>
    <button id="inboxBtn" class="fab inbox" title="Inbox">
      <img src="assets/img/icon-inbox.png" alt="Inbox" style="width:35px;height:35px;">
      <span id="inboxBadge" class="badge" style="display:none">0</span>
    </button>
  </div>

  <!-- Topbar -->
  <div class="topbar">
    <h1 class="logo-text"></h1>
    <div id="activityBar" class="activity-bar" aria-live="polite"></div>
  </div>

  <!-- Top actions -->
  <div class="top-actions" style="overflow:visible">
    <div>Saldo WLD:</div>
    <div><b id="balWLD">0.00</b> WLD</div>
    <div class="trophyWrap">
      <button id="trophyBtn" class="fab trophy" title="Leaderboard" type="button" aria-describedby="trophyTip">
        <img src="assets/img/icon-trophy.png" alt="Trophy" style="width:25px;height:25px;">
      </button>
      <div id="trophyTip" class="tip">Pr√≥ximamente</div>
    </div>
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="pill">
      <img src="assets/img/brand-mark-wg-128.png" alt="" onerror="this.style.display='none'">
      RBGp: <b id="balRBGp" aria-live="polite">0.000</b>
    </div>

    <div class="coinWrap" id="coinBox">
      <div class="ring"></div>
      <canvas id="fx"></canvas>

      <div id="coin" class="coin" aria-label="Tap">
        <svg id="windowArc" viewBox="0 0 100 100" style="position:absolute;inset:0;width:100%;height:100%;opacity:0;pointer-events:none;transform:rotate(-90deg);z-index:6">
          <defs>
            <linearGradient id="frenzy777" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%"   stop-color="#ff0055"/>
              <stop offset="20%"  stop-color="#ff9500"/>
              <stop offset="40%"  stop-color="#ffee00"/>
              <stop offset="60%"  stop-color="#33dd55"/>
              <stop offset="80%"  stop-color="#33aaff"/>
              <stop offset="100%" stop-color="#aa66ff"/>
            </linearGradient>
            <radialGradient id="haloArc" cx="50%" cy="50%" r="65%">
              <stop offset="0%"   stop-color="#ffffff" stop-opacity="1"/>
              <stop offset="35%"  stop-color="#FFD872" stop-opacity="1"/>
              <stop offset="70%"  stop-color="#cfae45" stop-opacity="0.8"/>
              <stop offset="100%" stop-color="#000000" stop-opacity="0"/>
            </radialGradient>
            <filter id="arcGlow" x="-60%" y="-60%" width="220%" height="220%">
              <feGaussianBlur in="SourceGraphic" stdDeviation="2.2" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <circle cx="50" cy="50" r="46" fill="none" stroke="#ffd872" stroke-width="4" stroke-linecap="round" pathLength="360"></circle>
        </svg>

        <div id="windowTag" style="
          position:absolute;top:8px;right:10px; padding:4px 10px;font-weight:800;font-size:12px;
          border-radius:12px; border:1px solid rgba(255,255,255,.18);
          background:rgba(0,0,0,.70);color:#ffd872; opacity:0; pointer-events:none; z-index:999">
        </div>

        <img src="assets/img/Coin.png" alt="" class="coinImg" onerror="this.remove();document.getElementById('fallback').style.display='block'">
        <div id="fallback" class="coinFallback" style="display:none">ü™ô</div>

        <div id="gain" style="position:absolute; left:0; top:0; font-size:14px; font-weight:900; color:#fff;
             text-shadow:0 2px 6px rgba(0,0,0,.55), 0 0 10px rgba(0,0,0,.35); pointer-events:none; z-index:1001;">
        </div>

        <div id="hot" style="position:absolute; inset:0; pointer-events:none; opacity:0; transition:opacity .18s ease;
             filter: drop-shadow(0 0 10px rgba(255,223,120,.25));"></div>

        <div id="hotCore" style="position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
             width:0; height:0; border-radius:50%; pointer-events:none; opacity:0;
             box-shadow: 0 0 6px rgba(0,0,0,.25) inset, 0 0 6px rgba(255,255,255,.15);"></div>

        <div id="comboBadge" style="
          position:absolute; top:10px; left:10px; background:rgba(0,0,0,.55);
          border:1px solid rgba(255,255,255,.18); color:#ffd872; font-weight:800; font-size:12px;
          padding:4px 8px; border-radius:10px; display:none; pointer-events:none;">
          <span id="comboTxt">COMBO x1</span>
        </div>

        <button id="ideasBtn" class="idea-btn" aria-label="Ideas">
          <img src="assets/img/icon-idea.png" alt="Ideas" onerror="this.style.display='none'">
        </button>
      </div>

      <!-- Dock -->
      <div class="action-dock" aria-label="acciones r√°pidas">
        <button id="refillBtn" class="btn-icon" aria-label="Refill">
          <img src="assets/img/ico-refill.png" alt="Refill" style="width:40px;height:40px;">
          <span id="refillPrice" class="price-pill">0.10 WLD</span>
        </button>
        <button id="openUp" class="btn-icon" aria-label="Boosters">
          <img src="assets/img/icon-gear.png" alt="Boosters" style="width:40px;height:35px;">
        </button>
      </div>

      <div class="energyWrap">
        <div class="energyBar"><div id="energyFill" class="energyFill" style="width:100%"></div></div>
        <div class="energyLbl">‚ö° <b id="energyNow">100</b>/<b id="energyMax">100</b></div>
      </div>
    </div>
  </section>

  <!-- Drawers e interfaces (id√©nticos a los tuyos)‚Ä¶ -->
  <!-- ‚Ä¶ (mantengo el resto tal cual tu HTML para no hacer la respuesta infinita) ‚Ä¶ -->

  <!-- Scripts de la app -->
  <script src="js/api-config.js"></script>
  <script src="js/game-logic.js"></script>
  <script src="js/payments.js"></script>
  <script type="module" src="js/minikit-config.js"></script>
</body>
</html>
